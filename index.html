<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <link rel="icon" type="image/png" href="caras/logo.png"> 
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nelson Contreras</title>
    
    <link href="https://fonts.googleapis.com/css2?family=MedievalSharp&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="media-session.js"></script> 
    
    <style>
        /* Definición de variables CSS */
        :root {
            --itunes-accent: #007aff;
            --header-bg-image: url('caras/syd.jpg'); 
            --header-folk-color: #ea580c; 
            --green-accent: #10b981; 
            --green-accent-hover: #059669; 
        }

        /* Estilos generales */
        body {
            font-family: 'Inter', sans-serif;
            color: #1f2937;
            padding-bottom: 96px; /* Espacio para la barra de reproducción fija */
        }
        
        body {
    font-family: 'Inter', sans-serif;
    color: #1f2937; /* Texto oscuro, casi negro */
    
    
    background-image: url('caras/fondo.jpg'); /* ⬅️ RUTA DE TU IMAGEN */
    background-size: cover; /* Cubre todo el fondo */
    background-attachment: fixed; /* Mantiene la imagen estática al hacer scroll */
    background-position: center center; /* Centra la imagen */
    
}

/* Creamos un pseudo-elemento que actúa como una capa gris/negra transparente */
body::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(226, 226, 174, 0.75); /* Capa blanca con 75% de opacidad */
    z-index: -1; /* Mantenlo detrás de todo el contenido */
}
        /* Estilos del Header y Texto Gótico */
        .header-background {
            background-color: var(--header-folk-color); 
            background-image: var(--header-bg-image);
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }

        .title-container {
            background-color: rgba(65, 64, 64, 0.5);
            backdrop-filter: blur(2px);
            -webkit-backdrop-filter: blur(2px);
            display: inline-block;
            padding: 8px 16px;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        
        .fractal-text {
            font-family: 'MedievalSharp', cursive;
            background: linear-gradient(45deg, #8B5CF6, #EC4899, #6366F1);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 
                0 0 8px rgba(139, 92, 246, 0.6),
                0 0 4px rgba(236, 72, 153, 0.4);
            display: block; 
            line-height: 1.1; 
        }
        
        /* Estilos de Pestañas y Tarjetas */
        .active-tab {
            border-bottom: 3px solid var(--itunes-accent); 
            color: #1f2937; 
            font-weight: 600;
        }
        .card-bg {
            background-color: #ffffff; 
            border: 1px solid #d1d5db;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .card-bg:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 15px -3px rgba(0, 122, 255, 0.15), 0 4px 6px -4px rgba(0, 122, 255, 0.08);
        }

        /* Reproductor Fijo (Mini-Barra Inferior) */
        #audio-player-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: #f7f7f7;
            border-top: 1px solid #e5e5e5;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
            z-index: 40;
            cursor: pointer; /* Indica que es clickeable para abrir el modal */
        }

        /* Estilos del Reproductor Ampliado (Modal) */
        #expanded-player {
            transform: translateY(100%);
            transition: transform 0.5s ease-out, visibility 0.5s, opacity 0.5s;
            visibility: hidden;
            opacity: 0;
            z-index: 100;
        }

        #expanded-player.show {
            transform: translateY(0);
            visibility: visible;
            opacity: 1;
        }
        
        #expanded-player #expanded-cover {
            box-shadow: 0 10px 30px rgba(0,0,0,0.4);
            transition: transform 0.3s ease-in-out;
        }
    </style>
</head>
<body class="min-h-screen">

    <div id="status-message" 
        class="hidden fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 
                bg-white border border-gray-200 p-6 rounded-xl shadow-2xl z-50 
                transition-all duration-300 max-w-lg w-11/12 md:w-full">
            </div>

    <div class="max-w-6xl mx-auto p-4 sm:p-6 lg:p-8">

        <header class="text-center py-10 mb-6 border-b border-gray-300 header-background rounded-xl">
            <div class="title-container mx-auto">
                <h1 class="text-4xl sm:text-5xl font-extrabold fractal-text">
                    The Piper and the Cosmic Mind
                   <span class="block text-xl sm:text-2xl font-normal mt-2">by George Singer</span>
                </h1>
            </div>
        </header>

        <nav class="flex justify-center space-x-4 mb-8">
                    <button id="tab-music" onclick="switchView('music')"
                            class="py-3 px-3 sm:px-6 text-base sm:text-lg rounded-t-lg transition-colors duration-200 hover:text-gray-900 hover:bg-gray-100 text-gray-900 active-tab">
                         Biblioteca Musical
                    </button>
                    <button id="tab-blog" onclick="switchView('blog')"
                            class="py-3 px-3 sm:px-6 text-base sm:text-lg rounded-t-lg transition-colors duration-200 hover:text-gray-900 hover:bg-gray-100 text-gray-600">
                         Proceso Creativo
                    </button>
                    <button id="tab-galeria" onclick="window.location.href='galeria.html'"
                      class="py-3 px-3 sm:px-6 text-base sm:text-lg rounded-t-lg transition-colors duration-200 hover:text-gray-900 hover:bg-gray-100 text-gray-600">
                        I'll See You On The Dark Side
                    </button>

                    <button id="tab-galeria-ava" onclick="window.location.href='ojo-fractal.html'"
                        class="py-3 px-3 sm:px-6 text-base sm:text-lg rounded-t-lg transition-colors duration-200 hover:text-gray-900 hover:bg-gray-100 text-gray-600">
                         <img src="caras/cuadro.gif" alt="Ojo Fractal Icono" class="h-6 w-6 inline-block mr-2" style="filter: grayscale(100%);">
                      <span class="align-middle">the Moon piper</span>
                    </button>
        </nav>

       <section id="music-view" class="space-y-6">
    
    <div class="flex items-center justify-between mb-6">
        <h2 class="text-2xl font-bold border-l-4 border-[#007aff] pl-4 text-gray-900">Últimos Lanzamientos</h2>
        
        <a href="https://www.facebook.com/profile.php?id=61578869703830" target="_blank" 
           class="p-1 rounded-full transition duration-200 hover:scale-110 flex-shrink-0">
            <img src="caras/facebook.png" alt="Facebook Icono" class="w-8 h-8">
        </a>
    </div>
    <div id="music-list" class="grid grid-cols-1 md:grid-cols-2 gap-6">
        </div>
</section>
        <section id="blog-view" class="space-y-8 hidden">
             <h2 class="text-2xl font-bold border-l-4 border-[#007aff] pl-4 text-gray-900 mb-6">Diario de Producción y Reflexiones</h2>
            <div id="blog-list" class="grid grid-cols-1 gap-8">
                </div>
        </section>

    </div>

    <div id="audio-player-bar" onclick="openExpandedPlayer()" class="flex items-center justify-between p-3 h-24">
        <audio id="audio-source" onended="handleTrackEnd()"></audio>

        <div class="flex items-center space-x-4 w-1/3 min-w-[200px]">
            <img id="player-cover" src="https://placehold.co/64x64/ccc/999?text=M" alt="Carátula"
                    class="w-16 h-16 rounded-lg object-cover shadow-lg">
            <div class="hidden sm:block min-w-0">
                <p id="player-title" class="text-sm font-bold text-gray-900 truncate">Ninguna pista seleccionada</p>
                <p id="player-genre" class="text-xs text-gray-600 truncate"></p>
            </div>
        </div>

        <div class="flex flex-col items-center w-1/3 max-w-sm sm:max-w-md">
            <div class="flex space-x-4 mb-1">
                <button onclick="handlePlayback('prev')" class="text-gray-500 hover:text-[var(--green-accent)] transition duration-150" aria-label="Pista Anterior">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="currentColor"><path d="M6 6h2v12H6zm3.5 6l8.5 6V6z"/></svg>
                </button>
                <button id="play-pause-btn" onclick="event.stopPropagation(); togglePlayPause();" class="text-gray-900 hover:text-[var(--green-accent)] transition duration-150" aria-label="Reproducir/Pausar">
                    <svg id="play-icon" xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>
                    <svg id="pause-icon" xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 hidden" viewBox="0 0 24 24" fill="currentColor"><path d="M6 19h4V5H6zm8-14v14h4V5z"/></svg>
                </button>
                <button onclick="handlePlayback('next')" class="text-gray-500 hover:text-[var(--green-accent)] transition duration-150" aria-label="Pista Siguiente">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="currentColor"><path d="M16 6v12h2V6zM6 18l8.5-6L6 6z"/></svg>
                </button>
            </div>
            <div class="flex items-center w-full space-x-2 text-xs text-gray-500 hidden sm:flex">
                <span id="current-time">0:00</span>
                <input type="range" id="progress-bar" value="0" min="0" max="100" class="flex-grow h-1 bg-gray-300 rounded-lg appearance-none cursor-pointer accent-[var(--green-accent)]">
                <span id="duration">0:00</span>
            </div>
        </div>
        
        <div class="w-1/3 flex justify-end items-center space-x-2 text-gray-500 hidden md:flex">
            <span>Volumen:</span>
            <input type="range" id="volume-slider" value="100" min="0" max="100" class="w-24 h-1 bg-gray-300 rounded-lg appearance-none cursor-pointer accent-[var(--green-accent)]">
        </div>
    </div>

    <div id="expanded-player" class="fixed inset-0 bg-black/90 backdrop-blur-xl hidden flex-col items-center justify-center z-[100] transition-transform duration-500 transform translate-y-full p-8">
        
        <button onclick="closeExpandedPlayer()" class="absolute top-6 right-6 text-white text-3xl opacity-70 hover:opacity-100 transition" aria-label="Cerrar Reproductor">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
        </button>
        
        <div class="flex flex-col items-center text-center w-full max-w-md">
             <img id="expanded-cover" src="https://placehold.co/300x300" 
                  class="w-64 h-64 sm:w-80 sm:h-80 rounded-2xl shadow-2xl mb-8 object-cover mx-auto">
             
             <h2 id="expanded-title" class="text-3xl sm:text-4xl text-white font-bold mb-1">Ninguna Pista</h2>
             <p id="expanded-genre" class="text-lg text-gray-300 mb-8"></p>
             
             <div class="flex items-center w-full space-x-2 text-xs text-gray-400 mb-10">
                <span id="expanded-current-time">0:00</span>
                <input type="range" id="expanded-progress-bar" value="0" min="0" max="100" 
                       class="flex-grow h-1 bg-gray-600 rounded-lg appearance-none cursor-pointer accent-[var(--green-accent)]">
                <span id="expanded-duration">0:00</span>
            </div>
        </div>

        <div class="flex items-center justify-center space-x-8">
            <button onclick="handlePlayback('prev')" class="text-gray-300 hover:text-green-400 transition" aria-label="Pista Anterior">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10" viewBox="0 0 24 24" fill="currentColor"><path d="M6 6h2v12H6zm3.5 6l8.5 6V6z"/></svg>
            </button>
            
            <button id="expanded-play-btn" onclick="togglePlayPause()" class="text-white hover:text-green-400 transition" aria-label="Reproducir/Pausar">
                <svg id="expanded-play-icon" xmlns="http://www.w3.org/2000/svg" class="h-16 w-16" viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>
                <svg id="expanded-pause-icon" xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 hidden" viewBox="0 0 24 24" fill="currentColor"><path d="M6 19h4V5H6zm8-14v14h4V5z"/></svg>
            </button>
            
            <button onclick="handlePlayback('next')" class="text-gray-300 hover:text-green-400 transition" aria-label="Pista Siguiente">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10" viewBox="0 0 24 24" fill="currentColor"><path d="M16 6v12h2V6zM6 18l8.5-6L6 6z"/></svg>
            </button>
        </div>
    </div>
    <script>
        // =========================================================================
        // CONFIGURACIÓN DE RUTAS Y DATOS
        // =========================================================================
        const musicData = [
            { id: 1, title: "Hijos de Neón", genre: "Experimental", duration: "05:26", description: "Experiencias de un viaje a los fractales de lucy.", file: "rolas/rola12.mp3", cover: "caras/mandala1.png" },
            { id: 2, title: "Ritmo Abstracto", genre: "Lo-Fi Beats", duration: "2:50", description: "Samples de lluvia y jazz suave para estudiar.", file: "rolas/ritmo_abstracto.mp3", cover: "caras/fractales.jpg" },
            { id: 3, title: "Amanecer en el Mar", genre: "Ambient / Chillout", duration: "5:12", description: "Texturas sonoras para la calma de la mañana en la costa.", file: "rolas/amanecer_mar.mp3", cover: "caras/amor.jpg" },
            { id: 4, title: "El Viaje del Héroe", genre: "Cinemático", duration: "4:30", description: "Pieza épica con cuerdas para una banda sonora imaginaria.", file: "rolas/viaje_heroe.mp3", cover: "caras/lsd.webp" },
            { id: 5, title: "Pulso Galáctico", genre: "Techno Melódico", duration: "6:05", description: "Ritmos hipnóticos y sintetizadores etéreos.", file: "rolas/pulso_galactico.mp3", cover: "caras/mandala2.jpg" },
            { id: 6, title: "Fractales de Luz", genre: "IDM / Experimental", duration: "3:18", description: "Diseño de sonido basado en patrones geométricos.", file: "rolas/fractales_luz.mp3", cover: "caras/mandala3.jpg" },
            { id: 7, title: "La Canción del Flautista", genre: "Folk Electrónico", duration: "4:00", description: "Fusión de instrumentos acústicos y sintetizadores.", file: "rolas/cancion_flautista.mp3", cover: "caras/mandala4.webp" },
            { id: 8, title: "Mente Cósmica", genre: "Trance", duration: "7:22", description: "Ascenso progresivo con un gran clímax melódico.", file: "rolas/mente_cosmica.mp3", cover: "caras/lsd2.jpg" },
            { id: 9, title: "Despertar Digital", genre: "Future Funk", duration: "00:35", description: "Grooves pegadizos y samples de música disco.", file: "rolas/rola3.mp3", cover: "caras/reina.jpg" },
            { id: 10, title: "Eco Eterno", genre: "Post-Punk", duration: "2:42", description: "Una Mirada Al Abismo  ", file: "rolas/rola2.mp3", cover: "caras/t3.webp" },
        ];
        
        const blogData = [
            // Contenido del blog omitido por brevedad
            { id: 101, title: "'Hijos de Neón'", date: "2025-09-15", excerpt: "Los Secretos del Caleidoscopio Mayor", content: "Mucho antes de que el Carnaval Multicolor fuera el festival de risas y luces que todos conocían, Lúmina era un reino de duendes regido por el silencio y el miedo. Sus habitantes vivían ocultos bajo la sombra de los Antiguos Espectros, entidades cósmicas de pura energía que, sin saberlo, tejían el velo de la realidad de los duendes,La historia del carnaval, en realidad, comienza con la Gran Disyunción. Un pequeño cónclave de duendes, los Primevos Sonambúlicos, descubrió que los Espectros no eran malignos, solo... indiferentes. Su existencia titánica generaba distorsiones en el espacio-tiempo que los duendes percibían como susurros, como colores imposibles, como una música abstracta y sin forma, Estos Primevos Sonambúlicos, liderados por la enigmática Elara, idearon un plan: no luchar contra los Espectros, sino interactuar con ellos. Erigieron el Caleidoscopio Mayor, no como un templo, sino como un laboratorio viviente. Era una estructura de cristal de cuarzo y musgo lumínico, diseñada para canalizar las energías psíquicas de los duendes y las vibraciones espectrales de los Antiguos, La primera noche de la Gran Disyunción, Elara y su cónclave entraron al Caleidoscopio. Empezaron a experimentar: abrieron portales efímeros hacia el Vacío para tocar las membranas de las criaturas cósmicas dormidas, susurrando conjuros de luz neón sobre las texturas fantasmales que emergían. No buscaban invocaciones directas, sino muestras sensoriales. De la interacción entre la psique duende y la esencia espectral, nacieron los primeros Hijos de Neón: destellos de luz que danzaban con geometrías imposibles, ecos de voces que nunca existieron y patrones rítmicos que solo la mente de un duende bajo la influencia del éter cósmico podía comprender,"}, 
            { id: 102, title: "Diario: Creando 'Ritmo Abstracto'", date: "2024-09-15", excerpt: "Explico la ciencia y el arte...", content: "..." },
            { id: 103, title: "Texturas Sonoras: Mi Enfoque en 'Amanecer en el Mar'", date: "2024-08-28", excerpt: "Un vistazo a las capas de síntesis...", content: "..." },
            { id: 104, title: "Orquestación Virtual: El Desafío de 'El Viaje del Héroe'", date: "2024-07-10", excerpt: "Detrás de escena de la pieza épica...", content: "..." },
            { id: 105, title: "Análisis de Groove: Creando 'Pulso Galáctico'", date: "2024-06-01", excerpt: "Profundizando en el 'kick drum'...", content: "..." },
            { id: 106, title: "Diseño de Sonido en 'Fractales de Luz' (IDM)", date: "2024-05-18", excerpt: "Un vistazo a los patrones rítmicos...", content: "..." },
            { id: 107, title: "Fusionando Mundos: La Historia Detrás de 'La Canción del Flautista'", date: "2024-04-10", excerpt: "La combinación de flautas étnicas...", content: "..." },
            { id: 108, title: "Estructura y Tensión en 'Mente Cósmica' (Trance)", date: "2024-03-01", excerpt: "Explorando la curva de tensión...", content: "..." },
            { id: 109, title: "Reviviendo los 90: El Espíritu de 'Despertar Digital'", date: "2024-02-14", excerpt: "Un tributo al Future Funk...", content: "..." },
            { id: 110, title: "Reflexiones sobre el Silencio: La Creación de 'Eco Eterno'", date: "2024-01-05", excerpt: "Mi aproximación al género New Age...", content: "..." }
        ];
        
        // =========================================================================
        // MANEJO DE EVENTOS Y ELEMENTOS DEL DOM
        // =========================================================================
        
        let currentView = 'music';
        let currentTrackIndex = -1;
        const DEFAULT_COVER = 'https://placehold.co/100x100/ccc/999?text=M';
        
        const audio = document.getElementById('audio-source');
        const playIcon = document.getElementById('play-icon');
        const pauseIcon = document.getElementById('pause-icon');
        const progressBar = document.getElementById('progress-bar');
        const volumeSlider = document.getElementById('volume-slider');
        const currentTimeEl = document.getElementById('current-time');
        const durationEl = document.getElementById('duration');
        const playerTitleEl = document.getElementById('player-title');
        const playerGenreEl = document.getElementById('player-genre');
        const playerCoverEl = document.getElementById('player-cover');

        // Elementos del Reproductor Ampliado
        const expandedPlayer = document.getElementById('expanded-player');
        const expandedCover = document.getElementById('expanded-cover');
        const expandedTitle = document.getElementById('expanded-title');
        const expandedGenre = document.getElementById('expanded-genre');
        const expandedPlayIcon = document.getElementById('expanded-play-icon');
        const expandedPauseIcon = document.getElementById('expanded-pause-icon');
        const expandedProgressBar = document.getElementById('expanded-progress-bar');
        const expandedCurrentTime = document.getElementById('expanded-current-time');
        const expandedDuration = document.getElementById('expanded-duration');


        function initializePlayerEvents() {
            audio.addEventListener('timeupdate', updateProgress);
            audio.addEventListener('play', () => updatePlayPauseIcon(true));
            audio.addEventListener('pause', () => updatePlayPauseIcon(false));
            audio.addEventListener('ended', handleTrackEnd);
            audio.addEventListener('loadedmetadata', updateProgress);

            volumeSlider.addEventListener('input', (e) => {
                audio.volume = e.target.value / 100;
            });

            progressBar.addEventListener('input', (e) => {
                audio.currentTime = (e.target.value / 100) * audio.duration;
            });
            
            expandedProgressBar.addEventListener('input', (e) => {
                audio.currentTime = (e.target.value / 100) * audio.duration;
            });
            
            audio.volume = 1.0;
        }

        function showMessage(message, isError = false) {
            const messageElement = document.getElementById('status-message');
            messageElement.classList.add('hidden');
            
            messageElement.classList.remove('bottom-4', 'right-4', 'bg-[#007aff]', 'text-white', 'p-3', 'max-w-xs', 'shadow-lg');
            messageElement.classList.remove('top-1/2', 'left-1/2', 'transform', '-translate-x-1/2', '-translate-y-1/2', 'max-w-lg', 'w-11/12', 'md:w-full', 'border', 'shadow-2xl');

            if (isError) {
                messageElement.classList.add('top-1/2', 'left-1/2', 'transform', '-translate-x-1/2', '-translate-y-1/2', 'max-w-lg', 'w-11/12', 'md:w-full', 'p-6', 'border-red-500', 'shadow-2xl');
                messageElement.innerHTML = `<h3 class="font-bold text-xl text-red-600 mb-2">Error de Reproducción</h3><p class="text-base">${message}</p><button onclick="document.getElementById('status-message').classList.add('hidden')" class="mt-4 w-full py-2 bg-red-100 hover:bg-red-200 text-red-800 rounded-lg font-semibold transition duration-150">Entendido</button>`;
            } else {
                messageElement.classList.add('bottom-4', 'right-4', 'bg-[#007aff]', 'text-white', 'p-3', 'rounded-lg', 'max-w-xs', 'shadow-lg');
                messageElement.innerHTML = message;
            }
            
            messageElement.classList.remove('hidden');

            if (!isError) {
                setTimeout(() => {
                    messageElement.classList.add('hidden');
                }, 3000);
            }
        }


        function renderMusic() {
            const listElement = document.getElementById('music-list');
            listElement.innerHTML = musicData.map(track => {
                return `
                <div class="card-bg p-4 rounded-xl shadow-md flex flex-col sm:flex-row items-start sm:items-center space-y-3 sm:space-y-0 sm:space-x-4">
                    <img src="${track.cover}" alt="Portada de ${track.title}"
                            class="w-16 h-16 rounded-lg object-cover flex-shrink-0"
                            onerror="this.onerror=null; this.src='${DEFAULT_COVER}';"
                    >
                    <div class="flex-grow min-w-0">
                        <h3 class="text-lg sm:text-xl font-bold text-[#d946ef] truncate">${track.title}</h3>
                        <p class="text-xs sm:text-sm text-gray-700">${track.genre} | ${track.duration}</p>
                        <p class="text-xs text-gray-500 mt-1">${track.description}</p>
                    </div>
                    <button onclick="loadAndPlay(${track.id})"
                            class="flex-shrink-0 bg-[var(--green-accent)] hover:bg-[var(--green-accent-hover)] text-white p-3 rounded-full shadow-md transition duration-150 ease-in-out transform hover:scale-105"
                            aria-label="Reproducir ${track.title}">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none" class="w-5 h-5">
                            <polygon points="5 3 19 12 5 21 5 3"></polygon>
                        </svg>
                    </button>
                </div>
                `;
            }).join('');
        }

        function renderBlog() {
            const listElement = document.getElementById('blog-list');
            listElement.innerHTML = blogData.map(post => {
                return `
                <div class="card-bg p-6 rounded-xl shadow-md border-l-4 border-gray-400 hover:border-[#007aff] transition duration-300">
                    <div class="flex justify-between items-start mb-2">
                        <h3 class="text-xl sm:text-2xl font-bold text-[#d946ef]">${post.title}</h3>
                        <span class="text-xs sm:text-sm text-gray-500">${post.date}</span>
                    </div>
                    <p class="text-sm sm:text-base text-gray-700 mt-2">${post.excerpt}...</p>
                    <div class="flex items-center space-x-3 mt-4">
                        <button onclick="readPost(${post.id})"
                                 class="inline-flex items-center text-[#007aff] hover:text-[#0066cc] transition duration-150 ease-in-out font-semibold">
                            Leer Post Completo
                            <svg xmlns="http://www.w3.org/2000/svg" class="ml-1 w-4 h-4" viewBox="0 0 20 20" fill="currentColor">
                                 <path fill-rule="evenodd" d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z" clip-rule="evenodd" />
                            </svg>
                        </button>
                    </div>
                </div>
                `;
            }).join('');
        }

        function readPost(postId) {
            const post = blogData.find(p => p.id === postId);
            if (post) {
                const messageElement = document.getElementById('status-message');
                if (messageElement) {
                    messageElement.classList.remove('hidden', 'bottom-4', 'right-4', 'bg-[#007aff]', 'text-white', 'p-3', 'max-w-xs', 'shadow-lg');
                    
                    messageElement.classList.add('top-1/2', 'left-1/2', 'transform', '-translate-x-1/2', '-translate-y-1/2', 'max-w-lg', 'w-11/12', 'md:w-full', 'p-6', 'border', 'shadow-2xl');

                    messageElement.innerHTML = `<h3 class="font-bold text-xl sm:text-2xl text-[#007aff]">${post.title}</h3><p class="text-sm text-gray-500 mb-4 border-b pb-2">${post.date}</p><div class="h-64 overflow-y-auto pr-2"><p class="text-sm sm:text-base text-gray-700 whitespace-pre-wrap">${post.content}</p></div><button onclick="document.getElementById('status-message').classList.add('hidden')" class="mt-6 w-full py-2 bg-gray-200 hover:bg-gray-300 text-gray-800 rounded-lg font-semibold transition duration-150">Cerrar</button>`;
                    messageElement.classList.remove('hidden');
                }
            }
        }

        function switchView(view) {
            currentView = view;
            const musicView = document.getElementById('music-view');
            const blogView = document.getElementById('blog-view');
            const tabMusic = document.getElementById('tab-music');
            const tabBlog = document.getElementById('tab-blog');

            if (view === 'music') {
                musicView.classList.remove('hidden');
                blogView.classList.add('hidden');
                tabMusic.classList.add('active-tab');
                tabBlog.classList.remove('active-tab');
            } else {
                musicView.classList.add('hidden');
                blogView.classList.remove('hidden');
                tabMusic.classList.remove('active-tab');
                tabBlog.classList.add('active-tab');
            }
        }

        function loadAndPlay(trackId) {
            const track = musicData.find(t => t.id === trackId);
            if (!track) return;
            
            currentTrackIndex = musicData.findIndex(t => t.id === trackId);

            audio.src = track.file;
            audio.load();
            
            playerTitleEl.textContent = track.title;
            playerGenreEl.textContent = track.genre;
            playerCoverEl.src = track.cover;
            
            expandedTitle.textContent = track.title;
            expandedGenre.textContent = track.genre;
            expandedCover.src = track.cover;

            playerCoverEl.onerror = expandedCover.onerror = function() {
                this.src = DEFAULT_COVER;
            };

            // ⭐️ Integración Media Session (Asume que updateMediaSession está en media-session.js) ⭐️
            if (typeof updateMediaSession === 'function') {
                updateMediaSession(track, audio); 
            }

            audio.play().then(() => {
                updatePlayPauseIcon(true);
                showMessage(`▶️ Reproduciendo: ${track.title}`);
            }).catch(error => {
                console.error("Error al reproducir el audio. Asegúrate de que el archivo existe en la ruta correcta.", error);
                showMessage(`❌ Error: No se pudo reproducir la pista '${track.title}'. Verifica la ruta del archivo.`, true);
                updatePlayPauseIcon(false);
            });
        }
        
        function updatePlayPauseIcon(isPlaying) {
            // Sincronizar barra inferior
            playIcon.classList.toggle('hidden', isPlaying);
            pauseIcon.classList.toggle('hidden', !isPlaying);
            // Sincronizar modal
            expandedPlayIcon.classList.toggle('hidden', isPlaying);
            expandedPauseIcon.classList.toggle('hidden', !isPlaying);
        }
        
        function togglePlayPause() {
            if (audio.paused) {
                if (currentTrackIndex === -1) {
                    loadAndPlay(musicData[0].id);
                } else {
                    audio.play();
                }
            } else {
                audio.pause();
            }
        }
        
        function handlePlayback(direction) {
            if (currentTrackIndex === -1) {
                 if (musicData.length > 0) loadAndPlay(musicData[0].id);
                 return;
            }

            let newIndex;
            if (direction === 'next') {
                newIndex = (currentTrackIndex + 1) % musicData.length;
            } else {
                newIndex = (currentTrackIndex - 1 + musicData.length) % musicData.length;
            }
            loadAndPlay(musicData[newIndex].id);
        }
        
        function handleTrackEnd() {
            handlePlayback('next');
        }

        function updateProgress() {
            const duration = audio.duration;
            const currentTime = audio.currentTime;

            if (duration && !isNaN(duration)) {
                const percent = (currentTime / duration) * 100;
                
                // Barra inferior
                progressBar.value = percent;
                currentTimeEl.textContent = formatTime(currentTime);
                durationEl.textContent = formatTime(duration);
                
                // Barra ampliada (Modal)
                expandedProgressBar.value = percent;
                expandedCurrentTime.textContent = formatTime(currentTime);
                expandedDuration.textContent = formatTime(duration);
            } else {
                // Estado inicial o error de carga
                progressBar.value = 0;
                currentTimeEl.textContent = '0:00';
                durationEl.textContent = '0:00';
                expandedProgressBar.value = 0;
                expandedCurrentTime.textContent = '0:00';
                expandedDuration.textContent = '0:00';
            }
        }

        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const remainderSeconds = Math.floor(seconds % 60);
            const formattedSeconds = remainderSeconds < 10 ? `0${remainderSeconds}` : remainderSeconds;
            return `${minutes}:${formattedSeconds}`;
        }
        
        function openExpandedPlayer() {
            updatePlayPauseIcon(!audio.paused);
            expandedPlayer.classList.remove('hidden');
            setTimeout(() => expandedPlayer.classList.add('show'), 10); 
        }

        function closeExpandedPlayer() {
            expandedPlayer.classList.remove('show');
            setTimeout(() => expandedPlayer.classList.add('hidden'), 500); 
        }

        
        // Función de inicialización
        function init() {
            renderMusic();
            renderBlog();
            switchView('music');
            initializePlayerEvents();
            
            if (musicData.length > 0) {
                // Inicialización de la UI con la primera pista
                playerTitleEl.textContent = musicData[0].title;
                playerGenreEl.textContent = musicData[0].genre;
                playerCoverEl.src = musicData[0].cover;
                expandedTitle.textContent = musicData[0].title;
                expandedGenre.textContent = musicData[0].genre;
                expandedCover.src = musicData[0].cover;
            }
        }

        // Ejecutar al cargar la página
        window.onload = init;
        
        // ⭐️ CORRECCIÓN CLAVE: Hacemos las funciones globales para que media-session.js pueda acceder a ellas ⭐️
        window.loadAndPlay = loadAndPlay;
        window.togglePlayPause = togglePlayPause;
        window.handlePlayback = handlePlayback;
        window.openExpandedPlayer = openExpandedPlayer;
        window.closeExpandedPlayer = closeExpandedPlayer;
        // ⭐️ FIN DE LA CORRECCIÓN ⭐️
    </script>

<center><img src="caras/tocadiscos.gif" height="50" width="50"></center>

</body>

</html>
